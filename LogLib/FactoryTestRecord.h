#pragma once

/*==============================================================================
System gain calculator.
==============================================================================*/

//******************************************************************************
//******************************************************************************
//******************************************************************************

#include <string>
#include "json.h"

//******************************************************************************
//******************************************************************************
//******************************************************************************
// This base class encapsulates a factory test record. It has methods to
// extract data from a string and to store it as a json value.
 
class BaseFactoryTestRecord
{
public:
   //***************************************************************************
   //***************************************************************************
   //***************************************************************************
   // Members.

   // Json file path.
   std::string mFilePath;

   // Json variables.
   Json::Value mJsonValue;

   // True if valid.
   bool mValidFlag;

   //***************************************************************************
   //***************************************************************************
   //***************************************************************************
   // Methods.

   // Constructor.
   BaseFactoryTestRecord();

   //***************************************************************************
   //***************************************************************************
   //***************************************************************************
   // Methods.

   // Read from the json file.
   void doReadFromJsonFile();

   // Write to the json file.
   void doWriteToJsonFile();

   // Test function.
   void test1(const std::string& aString);

   // Read from string sent by da or tta.
   virtual void fillWithCommandData(const std::string& aString);

   //***************************************************************************
   //***************************************************************************
   //***************************************************************************
   // Methods.

   // Support.
   void show(int aPrintFilter = 0);
};

//******************************************************************************
//******************************************************************************
//******************************************************************************
// These classes encapsulate factory test records for da and tta.

class FactoryTestRecordDA : public BaseFactoryTestRecord
{
public:
   typedef BaseFactoryTestRecord BaseClass;

   //***************************************************************************
   //***************************************************************************
   //***************************************************************************
   // Members.

   double mCtrlUnitTestportLoss;

   //***************************************************************************
   //***************************************************************************
   //***************************************************************************
   // Methods.

   // Constructor.
   FactoryTestRecordDA();

   //***************************************************************************
   //***************************************************************************
   //***************************************************************************
   // Methods.

   // Read from string sent by tta.
   void fillWithCommandData(const std::string& aString) override;
};

class FactoryTestRecordTTA : public BaseFactoryTestRecord
{
public:
   typedef BaseFactoryTestRecord BaseClass;

   //***************************************************************************
   //***************************************************************************
   //***************************************************************************
   // Members.

   // TTA gain, averaged from min,center,max
   double mTTAGainA;
   double mTTAGainB;
   double mTestportCouplerLoss;

   //***************************************************************************
   //***************************************************************************
   //***************************************************************************
   // Methods.

   // Constructor.
   FactoryTestRecordTTA();

   //***************************************************************************
   //***************************************************************************
   //***************************************************************************
   // Methods.

   // Read from string sent by tta.
   void fillWithCommandData(const std::string& aString) override;
};

//******************************************************************************
//******************************************************************************
//******************************************************************************

